const CalendarView=(e=>{const t="calendarView",a="bs.calendar-view",s=`.${a}`,n=e.fn[t],r={CHANGE:`change${s}`,CLICK_DATA_API:`click${s}.data-api`,OVER_DATA_API:`mouseenter${s}.data-api`,SELECT:`select${s}`,OVER:`over${s}`},i={CALENDAR_VIEW:"calendar-view",MONTH_VIEW:"calendar-month-view",WEEK_VIEW:"calendar-week-view",DAY_VIEW:"calendar-day-view",DAY_VIEW_TODAY:"calendar-day-view-today",DAY_VIEW_INFOCUS:"calendar-day-view-infocus",DAY_VIEW_OUTFOCUS:"calendar-day-view-outfocus",DAY_VIEW_SELECTED:"calendar-day-view-selected",DAY_VIEW_START:"calendar-day-view-start",DAY_VIEW_END:"calendar-day-view-end",DAY_VIEW_BETWEEN:"calendar-day-view-between",DAY_VIEW_DISABLED:"calendar-day-view-disabled"},d={CALENDAR_VIEW:`.${i.CALENDAR_VIEW}`,MONTH_VIEW:`tbody.${i.MONTH_VIEW}`,DAY_VIEW:`.${i.DAY_VIEW}`};class l{constructor(t){this._element=t,this._calendar="jalali",this._current=Pasoonate.make()[this._calendar](),this.beforeRenderDayAction=(e=>e.getDay()),this.render(),e(this._element).trigger(e.Event(r.CHANGE,{current:Pasoonate.make(this._current.getTimestamp())[this._calendar]()}))}render(){this._goto()}beforeRenderDay([e]){"function"==typeof e&&(this.beforeRenderDayAction=e,this._renderMonthView())}goto([e,t,a]){this._goto(e,t,a)}nextMonth(){let e=Pasoonate.make(this._current.getTimestamp())[this._calendar]();e.addMonth(1),this._goto(e.getYear(),e.getMonth())}prevMonth(){let e=Pasoonate.make(this._current.getTimestamp())[this._calendar]();e.subMonth(1),this._goto(e.getYear(),e.getMonth())}selectDay([t]){e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).addClass(i.DAY_VIEW_SELECTED)}clearSelection([t]){t?e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).removeClass(i.DAY_VIEW_SELECTED):e(this._element).find(d.DAY_VIEW).removeClass(i.DAY_VIEW_SELECTED)}selectRange([t,a]){const[s,n,r]=String(t).split("-"),l=Pasoonate.make().gregorian().setDate(Number(s),Number(n),Number(r));for(e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).addClass(i.DAY_VIEW_START),e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${a}]`).addClass(i.DAY_VIEW_END),l.addDay(1);l.format("yyyy-mm-dd")!==a;)e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${l.format("yyyy-mm-dd")}]`).addClass(i.DAY_VIEW_BETWEEN),l.addDay(1)}clearRange(){e(this._element).find(d.DAY_VIEW).removeClass([i.DAY_VIEW_START,i.DAY_VIEW_END,i.DAY_VIEW_BETWEEN])}startDay([t]){e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).addClass(i.DAY_VIEW_START)}endDay([t]){e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).addClass(i.DAY_VIEW_END)}disableDay([t]){e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).addClass(i.DAY_VIEW_DISABLED)}enableDay([t]){e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).removeClass(i.DAY_VIEW_DISABLED)}addClass([t,a]){e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).addClass(a)}removeClass([t,a]){e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).removeClass(a)}hasClass([t,a,s]){s.value=e(this._element).find(`${d.DAY_VIEW}[data-gregorian-date=${t}]`).hasClass(a)}getFirstAndLastDay([t]){const a=e(this._element).find(`${d.DAY_VIEW}`);a.length&&(t.first=Number(a[0].dataset.pick),t.last=Number(a[a.length-1].dataset.pick))}_renderMonthView(){let t,a=e(this._element).find(d.MONTH_VIEW),s=Pasoonate.make()[this._calendar]();a.empty(),s.setTimestamp(this._current.getTimestamp()).setDay(1),t=s.subDay(s.dayOfWeek());for(let e=1;e<=6;e++)a.append(this._renderWeekView(t,e)),t.addDay(7)}_renderWeekView(t,a){let s=e("<tr>"),n=Pasoonate.make(t.getTimestamp())[this._calendar]();s.addClass(i.WEEK_VIEW).addClass("week-"+a);for(let e=0;e<7;e++)s.append(this._renderDayView(n)),n.addDay(1);return s}_renderDayView(t){let a=this.beforeRenderDayAction(t),s=e('<td role="presentation">'),n=Pasoonate.make()[this._calendar]();return s.addClass(i.DAY_VIEW),s.attr("data-pick",t.getTimestamp()),s.attr("data-gregorian-date",Pasoonate.make(t.getTimestamp()).gregorian().format("yyyy-mm-dd")),t.getMonth()===this._current.getMonth()?(s.attr("data-day",t.getDay()),s.addClass(i.DAY_VIEW_INFOCUS)):s.addClass(i.DAY_VIEW_OUTFOCUS),t.format("yyyy-mm-dd")===n.format("yyyy-mm-dd")&&s.addClass(i.DAY_VIEW_TODAY),s.html(a),s}_goto(t,a,s){let n=Pasoonate.make(this._current.getTimestamp())[this._calendar](),i=!1;if(i=(t&&t!=this._current.getYear())|(a&&a!=this._current.getMonth())|(s&&s!=this._current.getDay())){this._current.setYear(parseInt(t)||this._current.getYear()),this._current.setMonth(parseInt(a)||this._current.getMonth()),this._current.setDay(parseInt(s)||this._current.getDay());const i=e.Event(r.CHANGE,{old:n,current:Pasoonate.make(this._current.getTimestamp())[this._calendar]()});if(e(this._element).trigger(i),i.isDefaultPrevented())return void this._current.setTimestamp(n.getTimestamp())}this._renderMonthView()}static _jQueryInterface(t,...s){return this.each(function(){const n=e(this);let r=n.data(a);if(r||(r=new l(this),n.data(a,r)),"string"==typeof t){if(void 0===r[t])throw new TypeError(`No method named "${t}"`);r[t](s)}})}}return e(document).on(r.CLICK_DATA_API,`${d.DAY_VIEW}:not(${d.DAY_VIEW_DISABLED})`,function(){e(this).closest(d.CALENDAR_VIEW).trigger(e.Event(r.SELECT,{relatedTarget:this}))}).on(r.OVER_DATA_API,`${d.DAY_VIEW}:not(${d.DAY_VIEW_DISABLED})`,function(){e(this).closest(d.CALENDAR_VIEW).trigger(e.Event(r.OVER,{relatedTarget:this}))}),e.fn[t]=l._jQueryInterface,e.fn[t].Constructor=l,e.fn[t].noConflict=function(){return e.fn[t]=n,l._jQueryInterface},l})($),DatePicker=(e=>{const t="datePicker",a="1.0.0",s="bs.date-picker",n=`.${s}`,r=e.fn[t],i={HIDE:`hide${n}`,HIDDEN:`hidden${n}`,SHOW:`show${n}`,SHOWN:`shown${n}`,FOCUS_CHANGE:`focus-change${n}`,CHANGE:`change${n}`,CLICK_DATA_API:`click${n}.data-api`,OVER_DATA_API:`mouseover${n}.data-api`},d={DATE_PICKER:"date-picker",DISABLED:"disabled",FADE:"fade",SHOW:"show",DAY_NUMBER:"date-picker-day-number",DAY_DISABLED:"date-picker-day-disabled",DAY_START:"date-picker-day-start",DAY_END:"date-picker-day-end",DAY_BETWEEN:"date-picker-day-between",BTN_NEXT_MONTH:"date-picker-btn-next-month",BTN_PREV_MONTH:"date-picker-btn-prev-month",YEAR_MONTH:"date-picker-year-month",LOCK_DAY:"calendar-day-view-lock",SELECTABLE_DAY:"calendar-day-view-selectable"},l={DATE_PICKER:".date-picker",INPUT:"input[type=date]",DISABLED:".disabled",DATA_TOGGLE:'[data-toggle="date-picker"]',DAY_NUMBER:".date-picker-day-number",BTN_NEXT_MONTH:".date-picker-btn-next-month",BTN_PREV_MONTH:".date-picker-btn-prev-month",YEAR_MONTH:".date-picker-year-month",CALENDAR_VIEW:".calendar-view"};class o{constructor(e){this._element=e,this._options={},this._startDay=null,this._endDay=null,this._focusOn="start",this._render()}show(){if(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&e(this._element).hasClass(d.DISABLED))return;const t=e(this._element.parentNode).find(l.DATE_PICKER)[0],a=e.Event(i.SHOW,{relatedTarget:this._element});if(e(this._element).trigger(a),a.isDefaultPrevented())return;e(t).addClass(d.SHOW),(()=>{const t=e.Event(i.SHOWN,{relatedTarget:this._element});e(this._element).trigger(t)})()}hide(){if(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&e(this._element).hasClass(d.DISABLED))return;const t=e(this._element.parentNode).find(l.DATE_PICKER)[0],a=e.Event(i.HIDE,{relatedTarget:this._element});if(e(this._element).trigger(a),a.isDefaultPrevented())return;e(t).removeClass(d.SHOW),(()=>{const t=e.Event(i.HIDDEN,{relatedTarget:this._element});e(this._element).trigger(t)})()}toggle(){if(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&e(this._element).hasClass(d.DISABLED))return;const t=e(this._element.parentNode).find(l.DATE_PICKER)[0];e(t).hasClass(d.SHOW)?this.hide():this.show()}dispose(){e.removeData(this._element,s),this._element=null}clear(){this._startDay=null,this._endDay=null,this._focusOn="start",e(this._element).parent().find(l.CALENDAR_VIEW).calendarView("clearRange"),this._autoUnlockDays();const t=e.Event(i.CHANGE,{startDay:this._startDay,endDay:this._endDay});e(this._element).trigger(t)}options([e]){for(let t in e)this._options[t]=e[t];this.refresh()}focusOn([t]){if("start"===t)this._focusOn=t;else if("end"===t)if(null===this._startDay){this._focusOn="start";const t=e.Event(i.FOCUS_CHANGE,{relatedTarget:this._element,focusOn:this._focusOn});e(this._element).trigger(t)}else this._focusOn=t}refresh(){const t=e(this._element.parentNode).find(l.CALENDAR_VIEW),a=this._dataKeyByDay();t.calendarView("render");for(const e in a)a[e].disabled&&t.calendarView("disableDay",e);this._startDay&&t.calendarView("startDay",this._startDay),this._endDay&&t.calendarView("endDay",this._endDay),this._startDay&&this._endDay&&(t.calendarView("clearRange"),t.calendarView("selectRange",this._startDay,this._endDay)),this._assignSelectableDays(),this._autoUnlockDays(),this._autoLockDays()}nextMonth(){const t=e(this._element.parentNode).find(l.CALENDAR_VIEW),a=this._dataKeyByDay();t.calendarView("nextMonth");for(const e in a)a[e].disabled&&t.calendarView("disableDay",e);this._startDay&&t.calendarView("startDay",this._startDay),this._endDay&&t.calendarView("endDay",this._endDay),this._startDay&&this._endDay&&(t.calendarView("clearRange"),t.calendarView("selectRange",this._startDay,this._endDay)),this._assignSelectableDays(),this._autoUnlockDays(),this._autoLockDays()}prevMonth(){const t=e(this._element.parentNode).find(l.CALENDAR_VIEW),a=this._dataKeyByDay();t.calendarView("prevMonth");for(const e in a)a[e].disabled&&t.calendarView("disableDay",e);this._startDay&&t.calendarView("startDay",this._startDay),this._endDay&&t.calendarView("endDay",this._endDay),this._startDay&&this._endDay&&(t.calendarView("clearRange"),t.calendarView("selectRange",this._startDay,this._endDay)),this._assignSelectableDays(),this._autoUnlockDays(),this._autoLockDays()}_render(){if(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&(e(this._element).hasClass(d.DISABLED)||this._element.hasAttribute("disabled")))return;let t=this._element,a=t.parentNode,s=e(`<div class="${d.DATE_PICKER}">`),n=e('<table class="calendar-view table table-borderless">'),r=e("<thead>").html(e('<tr class="calendar-nav">').html(e('<th class="p-1" colspan="7">').html('<div class="d-flex">'+`<div class="col-auto px-1"><button type="button" class="btn btn-link btn-sm ${d.BTN_PREV_MONTH}"><i class="icon icon-16 icon-arrow-right-muted">قبل</i></button></div>`+`<div class="col"><span class="${d.YEAR_MONTH}"></span></div>`+`<div class="col-auto px-1"><button type="button" class="btn btn-link btn-sm ${d.BTN_NEXT_MONTH}"><i class="icon icon-16 icon-arrow-left-muted">بعد</i></button></div>`+"</div>"))).append(e('<tr class="calendar-weekdays">').html('<th class="calendar-weekday" scope="col">ش</th><th class="calendar-weekday" scope="col">ی</th><th class="calendar-weekday" scope="col">د</th><th class="calendar-weekday" scope="col">س</th><th class="calendar-weekday" scope="col">چ</th><th class="calendar-weekday" scope="col">پ</th><th class="calendar-weekday" scope="col">ج</th>')),l=e('<tbody class="calendar-month-view">'),o=e("<tfoot>");o.html(e("<tr>").html(e('<td colspan="7" class="px-0 pb-0 text-left">').html(e('<button type="button" class="btn btn-outline-secondary">').text("پاک کردن").click(()=>{this.clear(),this.hide()})))),n.append(r).append(l).append(o),s.append(n),s.data("target",t),e(a).append(s).css("position","relative"),n.calendarView("beforeRenderDay",t=>{let a,s="",n="&nbsp;";(a=this._dataKeyByDay()[t.gregorian().format("yyyy-mm-dd")])&&(s=a.class,n=a.text);let r=e(`<div class="${d.DAY_NUMBER} ${s}}">`);return r.html(`<div>${t.jalali().getDay()}</div><div>${n}</div>`),r}),n.on("select.bs.calendar-view",t=>{const a=t.relatedTarget.dataset.gregorianDate,s=this._dataKeyByDay(),[r,l,o]=a.split("-"),_=Pasoonate.make();_.gregorian().setDate(Number(r),Number(l),Number(o));let c={};n.calendarView("hasClass",a,d.SELECTABLE_DAY,c),c=c.value;const h={};if(n.calendarView("hasClass",a,d.LOCK_DAY,h),h.value&&!c)return;if("start"===this._focusOn){if(this._startDay===a)return!0;if(this._startDay){if(this._startDay=a,null===this._endDay){if(s[a]&&s[a].disabled)return!0;e(n).calendarView("clearRange").calendarView("startDay",this._startDay)}else if(this._endDay>a){if(s[a]&&s[a].disabled)return!0;for(;_.gregorian().format("yyyy-mm-dd")!==this._endDay;){_.addDay(1);const e=_.gregorian().format("yyyy-mm-dd");if(s[e]&&s[e].disabled&&e!==this._endDay)return!0}e(n).calendarView("clearRange").calendarView("selectRange",this._startDay,this._endDay)}else if(this._endDay<a){if(s[a]&&s[a].disabled)return!0;e(n).calendarView("clearRange").calendarView("startDay",this._startDay),this._endDay=null}}else{if(s[a]&&s[a].disabled)return!0;this._startDay=a,e(n).calendarView("clearRange").calendarView("startDay",this._startDay),this._focusOn="end";const t=e.Event(i.FOCUS_CHANGE,{relatedTarget:this._element,focusOn:this._focusOn});e(this._element).trigger(t)}}else if("end"===this._focusOn){if(this._endDay===a)return!0;if(this._endDay){if(this._endDay=a,null===this._startDay){this._focusOn="start";const t=e.Event(i.FOCUS_CHANGE,{relatedTarget:this._element,focusOn:this._focusOn});return e(this._element).trigger(t),!0}if(this._startDay<a){if(s[a]&&s[a].disabled&&!c)return!0;for(;_.gregorian().format("yyyy-mm-dd")!==this._startDay;){_.subDay(1);const e=_.gregorian().format("yyyy-mm-dd");if(s[e]&&s[e].disabled)return!0}e(n).calendarView("clearRange").calendarView("selectRange",this._startDay,this._endDay)}else if(this._startDay>a){if(s[a]&&s[a].disabled)return!0;e(n).calendarView("clearRange").calendarView("startDay",this._endDay),this._startDay=this._endDay,this._endDay=null}}else{if(s[a]&&s[a].disabled&&!c)return!0;for(;_.gregorian().format("yyyy-mm-dd")!==this._startDay;){_.subDay(1);const e=_.gregorian().format("yyyy-mm-dd");if(s[e]&&s[e].disabled)return!0}this._endDay=a,e(n).calendarView("clearRange").calendarView("selectRange",this._startDay,this._endDay)}}const D=e.Event(i.CHANGE,{startDay:this._startDay,endDay:this._endDay});e(this._element).trigger(D),this._autoUnlockDays(),this._autoLockDays(),this.hide()}),n.on("over.bs.calendar-view",t=>{const a=t.relatedTarget.dataset.gregorianDate,s=this._dataKeyByDay(),[r,i,d]=a.split("-"),l=Pasoonate.make();if(l.gregorian().setDate(Number(r),Number(i),Number(d)),this._startDay==a)return!0;if(null===this._startDay||this._startDay>a)return!0;if(this._startDay&&null===this._endDay){if(s[a]&&s[a].disabled)return!0;for(;l.gregorian().format("yyyy-mm-dd")!==this._startDay;){l.subDay(1);const e=l.gregorian().format("yyyy-mm-dd");if(s[e]&&s[e].disabled)return!0}e(n).calendarView("clearRange").calendarView("selectRange",this._startDay,a)}})}_dataKeyByDay(){let e={};if(void 0===this._options.data)return e;for(const t of this._options.data)e[t.day]=t;return e}_autoLockDays(){const t=e(this._element.parentNode).find(l.CALENDAR_VIEW),a=this._dataKeyByDay(),s={};if(t.calendarView("getFirstAndLastDay",s),this._startDay){const[n,r,i]=this._startDay.split("-"),l=Pasoonate.make();l.gregorian().setDate(Number(n),Number(r),Number(i));let o=!1;for(;l.getTimestamp()<=s.last;){l.gregorian().addDay(1);const s=l.gregorian().format("yyyy-mm-dd");!o&&a[s]&&a[s].disabled&&(o=!0),o&&e(t).calendarView("addClass",s,d.LOCK_DAY)}for(o=!1,l.gregorian().setDate(Number(n),Number(r),Number(i));l.getTimestamp()>=s.first;){l.gregorian().subDay(1);const s=l.gregorian().format("yyyy-mm-dd");!o&&a[s]&&a[s].disabled&&(o=!0),o&&e(t).calendarView("addClass",s,d.LOCK_DAY)}}}_autoUnlockDays(){const t=e(this._element.parentNode).find(l.CALENDAR_VIEW),a={};t.calendarView("getFirstAndLastDay",a);const s=Pasoonate.make(a.first);for(;s.getTimestamp()<=a.last;)s.gregorian().addDay(1),t.calendarView("removeClass",s.gregorian().format("yyyy-mm-dd"),d.LOCK_DAY)}_assignSelectableDays(){const t=e(this._element.parentNode).find(l.CALENDAR_VIEW),a=this._dataKeyByDay(),s={};t.calendarView("getFirstAndLastDay",s);const n=Pasoonate.make(s.first);let r=0;for(;n.getTimestamp()<=s.last;){const s=n.gregorian().format("yyyy-mm-dd");1===(r=a[s]&&a[s].disabled?0===r?1:2:0)&&e(t).calendarView("addClass",s,d.SELECTABLE_DAY),n.addDay(1)}}static get VERSION(){return a}static _jQueryInterface(t,...a){return this.each(function(){const n=e(this);let r=n.data(s);if(r||(r=new o(this),n.data(s,r)),"string"==typeof t){if(void 0===r[t])throw new TypeError(`No method named "${t}"`);r[t](a)}})}}return e(document).on(i.CLICK_DATA_API,l.BTN_NEXT_MONTH,function(t){e(this).closest(l.DATE_PICKER).parent().find(l.DATA_TOGGLE).datePicker("nextMonth")}).on(i.CLICK_DATA_API,l.BTN_PREV_MONTH,function(t){e(this).closest(l.DATE_PICKER).parent().find(l.DATA_TOGGLE).datePicker("prevMonth")}).on("change.bs.calendar-view",`${l.DATE_PICKER} ${l.CALENDAR_VIEW}`,function(t){e(this).find(l.YEAR_MONTH).html(Pasoonate.trans(`jalali.month_name.${t.current.getMonth()}`)+" "+t.current.getYear())}).on("click",function(t){let a=e(".date-picker.show");if(a.length){if(a.parent().find(e(t.target)).length)return!0}a.datePicker("hide")}),e.fn[t]=o._jQueryInterface,e.fn[t].Constructor=o,e.fn[t].noConflict=function(){return e.fn[t]=r,o._jQueryInterface},o})($);